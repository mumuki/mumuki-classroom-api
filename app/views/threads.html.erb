<div class="messages">
  <ol class="chat">
    <% threads.each_with_index do |thread, index| %>
        <div class="thread">
          <li class="solution self">
            <a onclick="toggleCollapse('magia-<%= index %>')">
              <i class="fa fa-<%= threads.last == thread ? 'minus' : 'plus' %>-square-o magia-<%= index %>"></i>
              <span>&nbsp;</span>
              <span> Ver soluci√≥n </span>
            </a>
            <div id="magia-<%= index %>" class="<%= thread[:status] %> msg magia-no">
              <%= thread[:content] %>
              <time style="font-weight: bold;"><%= thread[:created_at] %></time>
            </div>
          </li>
          <% thread[:messages].each do |message| %>
              <li class="<%= message.sender == user.uid ? 'self' : 'other' %>">
                <div class="msg">
                  <p> <%= message.content %></p>
                  <div class="sender"><%= message.sender %></div>
                  <time><%= message.created_at %></time>
                </div>
              </li>
          <% end %>
        </div>
    <% end %>
  </ol>
</div>


<script>
  function toggleCollapse(target) {
    var $target = $('#' + target);
    var $icon = $('i.' + target);
    $icon.toggleClass('fa-minus-square-o');
    $icon.toggleClass('fa-plus-square-o');
    $target.toggleClass('magia');
  }

  $('.view-messages time').each(function (i, e) {
    return e.innerText = moment(e.innerText).fromNow();
  });
</script>
